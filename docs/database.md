# Структура базы данных KURS Service

## Введение

Данный документ описывает структуру базы данных проекта автосервиса KURS Service. В нем приведены основные таблицы (модели Django), их поля, связи, а также рекомендации по работе с данными, миграциями и расширением БД.

---

## Общие принципы проектирования

- Используется MySQL
- Все модели определяются в файлах `models.py` соответствующих приложений
- Для связей используются ForeignKey, ManyToManyField, OneToOneField
- Для хранения изображений и файлов — поля ImageField/FileField, директория media/
- Для статики — директория static/

---

## Основные таблицы и модели

| Таблица/Модель             | Описание                                    |
| -------------------------- | ------------------------------------------- |
| price_maintenance_category | Категории услуг ТО                          |
| price_maintenance_price    | Прайс-лист услуг ТО                         |
| discounts_discount         | Акции и скидки                              |
| evacuation_form            | Заявки на эвакуацию                         |
| onlineappointmentform      | Заявки на онлайн-запись                     |
| photo_gallery              | Фотогалерея работ                           |
| reviews_review             | Отзывы клиентов                             |
| news_news                  | Новости компании                            |
| check_list                 | Корзина и чек-лист пользователя             |
| insurance_form             | Заявки на страхование                       |
| users (auth_user)          | Пользователи сайта                          |
| ...                        | (см. apps.md для полного списка приложений) |

---

## Особенности хранения медиа и статики

- Все изображения и файлы — через поля ImageField/FileField, хранятся в папке media/
- Для статики (css, js, иконки) — папка static/
- Пути к файлам формируются автоматически через настройки MEDIA_ROOT, MEDIA_URL, STATIC_ROOT, STATIC_URL

---

## Примеры запросов (Django ORM и SQL)

**Получить все услуги определённой категории:**

```python
Price.objects.filter(category__name="Диагностика")
```

**Получить все отзывы пользователя:**

```python
Review.objects.filter(user__username="user1")
```

**SQL: Найти все заявки на эвакуацию за месяц:**

```sql
SELECT * FROM evacuation_form WHERE created_at >= '2024-05-01' AND created_at < '2024-06-01';
```

---

## Миграции и поддержка БД

- Для создания/обновления структуры — команды Django: `python manage.py makemigrations`, `python manage.py migrate`
- Для резервного копирования — используйте mysqldump (MySQL)
- Для тестирования изменений — используйте отдельную тестовую БД
- Для расширения — добавляйте новые модели/поля через миграции

---

## Рекомендации по безопасности и производительности

- Используйте индексы для часто используемых полей (ForeignKey, search)
- Не храните чувствительные данные в открытом виде
- Регулярно делайте бэкапы
- Используйте транзакции для критичных операций

---

## Подробнее

- Структуру и поля всех моделей смотрите в соответствующих файлах `models.py` каждого приложения
- Полный список приложений — в [docs/apps.md](apps.md)
- Подробнее о работе с медиа и статикой — в [docs/static_media.md](static_media.md)
- Руководство администратора — в [docs/admin_guide.md](admin_guide.md)
- Официальная документация Django: [https://docs.djangoproject.com/](https://docs.djangoproject.com/)

---
